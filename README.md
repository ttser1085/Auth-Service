# Auth-Service
Сервис для регистрации, аутентификации и авторизации пользователей key-value хранилища. Хранилище для простоты умеет только хранить в памяти строковые ключи и значения, но с одним нюансом. Пространство ключей общее для всех пользователей, но пользователь может прочитать или перезаписать только свои ключи - те, которые он создал первым.

Регистрация и аутентификация пользователей реализована через отдельный сервис, который хранит учетные данные и выдает пользователям токены для доступа к хранилищу. В свою очередь, сервис хранилища валидирует токен из запроса пользователя и проверять права на выполнение запрашиваемой операции. 

Для доступа пользователей к сервисам используется HTTP. Для простоты опустим защиту передаваемых по сети данных, но на практике здесь должен быть HTTPS. Для генерации токенов доступа используется стандарт [JSON Web Token](https://ru.wikipedia.org/wiki/JSON_Web_Token) (JWT).

### Сервис аутентификации

Сервис выполняет функции регистрации новых пользователей, аутентификации по логину/паролю и проверки существующего токена. Соответственно, сервис имеет три HTTP хэндлера: `/signup`, `/login`, `/whoami`.

#### Регистрация

```
POST /signup
body: { "username": "kek", "password": "kekpassword" }
```

Статусы ответа:
- 200 если новый пользователь успешно зарегистрирован, в этом случае в заголовке `Set-Cookie` будет передан (как [кука](https://ru.wikipedia.org/wiki/Cookie)) токен, который надо использовать при доступе к хранилищу.
- 403 если пользователь с таким именем уже существует.

#### Аутентификация

```
POST /login
body: { "username": "kek", "password": "kekpassword" }
```

Статусы ответа:
- 200 если аутентификация прошла успешно, в этом случае в заголовке `Set-Cookie` будет передан токен, который надо использовать при доступе к хранилищу.
- 403 если пользователя не существует или передан неверный пароль.

#### Проверка токена

```
GET /whoami
Cookie: jwt=...
```

Статусы ответа:
- 200 если токен из куки валидный, тогда в теле ответа передается `Hello, {username}`.
- 401 если заголовок Cookie отсутствует.
- 400 если токен не валидный (мусор или подписана другой подписью).

### Key-value хранилище

Хранилище поддерживает операции записи и чтения значений по ключу. При этом проверяется право пользователя на выполнении операции с данным ключом. Далее будем считать, что ключ принадлежит пользователю, если он был создан этим пользователем.

#### Запись значения ключа

```
POST /put?key=kek
Cookie: jwt=...
body: { "value": "lol" }
```

Статусы ответа:
- 200 если запись успешна (ключа не было изначально, либо он принадлежит пользователю).
- 403 если ключ существует, но принадлежит другому пользователю.
- 401 если куки с токеном нет.
- 400 если токен не валидный.

#### Чтение значения ключа

```
GET /get?key=kek
Cookie: jwt=...
```

Статусы ответа:
- 200 если ключ есть и принадлежит пользователю, тогда в теле ответа передается `{"value": "lol"}`.
- 403 если ключ существует, но принадлежит другому пользователю.
- 404 если ключа не существует.
- 401 если куки с токеном нет.
- 400 если токен не валидный.
